{% extends 'base.html' %}

{% block title %}View Meeting - Attendance Manager{% endblock %}

{% block content %}
    <h2 class="centered">Meeting Details</h2>
    <a href="{{ url_for('group_meetings', group_id=meeting.group_id) }}" class="return-button">< Back</a>
    <div class="form-container centered">
        <p><strong>Date and Time:</strong> {{ meeting.date_time }}</p>
        {% if meeting.canceled %} <p><strong>Canceled</strong></p> {% endif %}
        <a href="{{ url_for('edit_meeting', meeting_id=meeting.id) }}" class="button">Edit Meeting</a>

    </div>
    <div class="container centered">
        <form action="{{ url_for('meeting_attendance', meeting_id=meeting.id) }}" method="post">
            {% if device.is_mobile %}
                <select name="attendance_type" id="attendance_type">
                    <option value="before">Before Meeting</option>
                    <option value="during">During Meeting</option> 
                </select> <br> 

                <span class="tooltip-container">
                    <i class="fa-solid fa-circle-question"></i>
                    <span class="tooltip-text">A checked box indicates the person will be present at the meeting. <br>Warning, check the drop down to select whether it is before the meeting or during! (calling in sick ect.)</span>
                </span>
                <br>
            {% endif %}

            
            <button type="submit" class="button">Save Attendances</button>

            {% if device.is_mobile == false %}
                <span class="tooltip-container">
                    <i class="fa-solid fa-circle-question"></i>
                    <span class="tooltip-text">A checked box indicates the person will be present at the meeting. <br>Warning, check the drop down to select whether it is before the meeting or during! (calling in sick ect.)</span>
                </span>

                <select name="attendance_type" id="attendance_type">
                    <option value="before">Before Meeting</option>
                    <option value="during">During Meeting</option> 
                </select> <br> <br>
            {% endif %}

            {% if people %}
                <div class="card-list">
                    {% for person in people %}
                        <a href="{{ url_for('view_person', person_id=person.id) }}" class="no-link-style">
                            <div class="person-attendance-card">
                                <div class="person-row">
                                    <div class="person-info">
                                        <div class="person-name">{{ person.name }}</div>
                                        <div class="person-role {% if person.role == 2 %}role-2{% elif person.role == 1 %}role-1{% endif %}">
                                            {% if person.role == 2 %}Leader{% elif person.role == 1 %}Counsil{% else %}Member{% endif %}
                                        </div>
                                        
                                    </div>

                                    <div class="person-attendance-status">
                                                <label class="presence-label">
                                                    <!-- send explicit per-person keys: presence[<id>] -->
                                                    <input type="hidden" name="presence[{{ person.id }}]" value="0">
                                                    <input type="checkbox" name="presence[{{ person.id }}]" value="1" id="presence-{{ person.id }}" class="presence-checkbox" onclick="event.stopPropagation();"
                                                    {% if person.attendance.presence == 1 %} checked{% endif %}>
                                                </label>
                                        &nbsp;
                                        {% if person.attendance.presence == 2 or person.default_presence == 2 %}
                                            <div class="person-role status-badge-orange">
                                                Late
                                            </div>                                        
                                        {% endif %}
                                        {% if person.attendance.presence == 3 %}
                                            <div class="person-role status-badge-teal">
                                                Excused
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                <p>No people in this group.</p>
            {% endif %}
        </form>
    </div>
{% endblock %}